<p-toast />

<form [formGroup]="editCategoryForm" (ngSubmit)="onSubmit()">
  <div class="dialog-content">
    <!-- Category Type -->
    <div class="form-field">
      <label for="categoryTypeId">Kategoria *</label>
      <p-select
        id="categoryTypeId"
        formControlName="categoryTypeId"
        [options]="categoryTypes"
        optionLabel="name"
        optionValue="id"
        placeholder="Wybierz kategorię"
        [style]="{ width: '100%' }"
        [class.ng-invalid]="editCategoryForm.controls['categoryTypeId'].invalid && editCategoryForm.controls['categoryTypeId'].touched"
        [class.ng-dirty]="editCategoryForm.controls['categoryTypeId'].dirty"
      >
        <ng-template pTemplate="selectedItem" let-selectedOption>
          @if (selectedOption) {
            <div class="flex align-items-center gap-2">
              <span>{{ selectedOption.name }}</span>
            </div>
          }
        </ng-template>
        <ng-template pTemplate="item" let-categoryType>
          <div class="flex align-items-center gap-2">
            <span>{{ categoryType.name }}</span>
          </div>
        </ng-template>
      </p-select>
      @if (editCategoryForm.controls['categoryTypeId'].invalid && editCategoryForm.controls['categoryTypeId'].touched) {
        <small class="p-error">
          @if (editCategoryForm.controls['categoryTypeId'].errors?.['required']) {
            Kategoria jest wymagana.
          }
        </small>
      }
    </div>

    <!-- Name -->
    <div class="form-field">
      <label for="name">Nazwa podkategorii *</label>
      <input
        id="name"
        type="text"
        pInputText
        formControlName="name"
        placeholder="np. Kocioł gazowy, Kompost, Dentysta"
        [class.ng-invalid]="editCategoryForm.controls['name'].invalid && editCategoryForm.controls['name'].touched"
        [class.ng-dirty]="editCategoryForm.controls['name'].dirty"
      />
      @if (editCategoryForm.controls['name'].invalid && editCategoryForm.controls['name'].touched) {
        <small class="p-error">
          @if (editCategoryForm.controls['name'].errors?.['required']) {
            Nazwa podkategorii jest wymagana.
          }
          @if (editCategoryForm.controls['name'].errors?.['maxlength']) {
            Nazwa nie może przekroczyć 100 znaków.
          }
        </small>
      }
    </div>

    <!-- Description -->
    <div class="form-field">
      <label for="description">Opis (opcjonalnie)</label>
      <textarea
        id="description"
        pTextarea
        formControlName="description"
        placeholder="Dodatkowe informacje o podkategorii"
        [rows]="3"
        [class.ng-invalid]="editCategoryForm.controls['description'].invalid && editCategoryForm.controls['description'].touched"
        [class.ng-dirty]="editCategoryForm.controls['description'].dirty"
      ></textarea>
      @if (editCategoryForm.controls['description'].invalid && editCategoryForm.controls['description'].touched) {
        <small class="p-error">
          @if (editCategoryForm.controls['description'].errors?.['maxlength']) {
            Opis nie może przekroczyć 500 znaków.
          }
        </small>
      }
    </div>

    <!-- Sort Order -->
    <div class="form-field">
      <label for="sortOrder">Kolejność sortowania</label>
      <p-inputNumber
        id="sortOrder"
        formControlName="sortOrder"
        [min]="0"
        [showButtons]="true"
        [style]="{ width: '100%' }"
        [class.ng-invalid]="editCategoryForm.controls['sortOrder'].invalid && editCategoryForm.controls['sortOrder'].touched"
        [class.ng-dirty]="editCategoryForm.controls['sortOrder'].dirty"
      ></p-inputNumber>
      @if (editCategoryForm.controls['sortOrder'].invalid && editCategoryForm.controls['sortOrder'].touched) {
        <small class="p-error">
          @if (editCategoryForm.controls['sortOrder'].errors?.['min']) {
            Kolejność sortowania musi być większa lub równa 0.
          }
        </small>
      }
    </div>
  </div>

  <div class="dialog-footer">
    <p-button
      label="Anuluj"
      severity="secondary"
      (onClick)="closeDialog()"
      [disabled]="isLoading()"
    />
    <p-button
      label="Zapisz zmiany"
      type="submit"
      [loading]="isLoading()"
      [disabled]="editCategoryForm.invalid || isLoading()"
    />
  </div>
</form>
